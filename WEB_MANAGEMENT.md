# 咸鱼AI客服系统 - Web管理界面

## 📖 简介

这是咸鱼AI客服系统的Web管理界面，提供了一个现代化的图形化管理面板，用于控制和监控AI客服进程。

## ✨ 功能特性

### 🎛️ 进程管理
- **启动/停止/重启** main.py 进程
- **实时状态监控** - CPU、内存使用率
- **进程健康检查** - 自动检测进程异常
- **优雅停止** - 支持安全的进程终止

### 📊 实时监控
- **系统状态面板** - 显示进程运行状态
- **资源使用监控** - CPU和内存使用情况
- **运行时间统计** - 进程启动时间和运行时长

### 📋 日志管理
- **实时日志流** - 基于Server-Sent Events的实时日志显示
- **日志过滤** - 按级别(DEBUG/INFO/WARNING/ERROR)区分显示
- **自动滚动** - 可开关的自动滚动到最新日志
- **历史日志** - 保留最近1000条日志记录

### 🎨 用户界面
- **现代化设计** - 基于渐变色的美观界面
- **响应式布局** - 支持移动端和桌面端
- **实时反馈** - 操作状态提示和加载动画
- **暗色日志** - 类IDE的日志显示界面

## 🚀 快速开始

### 方式一：使用快速启动脚本（推荐）

```bash
python start.py
```

然后选择启动模式：
- **选项1**: 启动命令行管理工具（推荐新手使用）
- **选项2**: 直接启动Web界面
- **选项3**: 直接运行main.py

### 方式二：使用命令行管理工具

```bash
python manager.py
```

命令行工具提供以下功能：
- 🚀 启动/停止Web应用
- 📊 查看系统状态
- 🔄 重启Web应用
- 🌐 自动打开浏览器

### 方式三：直接启动Web应用

```bash
python web_app.py
```

然后在浏览器中访问：http://127.0.0.1:5000

## 📋 系统要求

### Python依赖
```
flask==3.0.0
psutil==5.9.8
loguru==0.7.3
requests==2.32.3
```

安装依赖：
```bash
pip install -r requirements.txt
```

### 系统要求
- Python 3.7+
- Linux/Windows/macOS
- 最少512MB内存
- 支持现代浏览器（Chrome、Firefox、Safari、Edge）

## 🎛️ 使用指南

### Web界面操作

1. **系统状态卡片**
   - 显示AI客服进程的当前状态
   - 实时更新进程PID、运行时间、资源使用情况
   - 状态指示器：🟢运行中 🔴已停止 🟡启动中/停止中

2. **控制面板**
   - **启动AI客服**: 启动main.py进程
   - **停止AI客服**: 安全停止进程
   - **重启AI客服**: 先停止再启动进程
   - **刷新状态**: 手动刷新系统状态

3. **实时日志**
   - 实时显示main.py的输出日志
   - 支持颜色编码的日志级别
   - 连接状态指示器
   - 清空日志和自动滚动控制

### 命令行工具操作

启动 `manager.py` 后，使用数字选择操作：

```
🎛️ 操作菜单:
----------------------------------------
1. 启动Web应用
2. 停止Web应用  
3. 重启Web应用
4. 查看系统状态
5. 打开Web界面
0. 退出程序
----------------------------------------
```

## 🔧 配置选项

### Web应用配置

可以通过命令行参数配置Web应用：

```bash
python web_app.py --host 0.0.0.0 --port 8080 --debug
```

参数说明：
- `--host`: 绑定的主机地址（默认：127.0.0.1）
- `--port`: 监听端口（默认：5000）
- `--debug`: 启用调试模式

### 环境变量

系统会读取以下环境变量：
- `LOG_LEVEL`: 日志级别（DEBUG/INFO/WARNING/ERROR）
- `COOKIES_STR`: 咸鱼登录Cookie
- `HEARTBEAT_INTERVAL`: 心跳间隔（秒）
- 其他main.py相关的环境变量

## 🛠️ 技术架构

### 后端技术栈
- **Flask**: Web框架
- **Server-Sent Events**: 实时日志流
- **psutil**: 进程监控
- **subprocess**: 进程管理
- **threading**: 多线程处理

### 前端技术栈
- **原生JavaScript**: 前端逻辑
- **CSS3**: 现代化样式
- **EventSource API**: 实时日志接收
- **Fetch API**: HTTP请求

### 核心特性
- **低延迟**: 基于SSE的实时通信
- **高可靠**: 进程状态自动检测
- **易扩展**: 模块化设计
- **跨平台**: 支持主流操作系统

## 🔍 API接口

### REST API

- `GET /api/status` - 获取系统状态
- `POST /api/start` - 启动主进程
- `POST /api/stop` - 停止主进程
- `GET /api/logs?lines=100` - 获取历史日志

### 实时API

- `GET /api/logs/stream` - Server-Sent Events日志流

### 响应格式

```json
{
    "success": true,
    "data": {
        "status": "running",
        "pid": 12345,
        "start_time": "2024-01-01T12:00:00",
        "running_time": "1:23:45",
        "cpu_percent": 2.5,
        "memory_mb": 128.5,
        "memory_percent": 1.2
    }
}
```

## 🚨 故障排除

### 常见问题

1. **Web应用启动失败**
   - 检查端口是否被占用
   - 确认Python依赖已安装
   - 查看错误日志

2. **main.py启动失败**
   - 检查环境变量配置
   - 确认Cookie有效性
   - 查看详细错误信息

3. **实时日志不显示**
   - 检查浏览器控制台错误
   - 确认SSE连接状态
   - 刷新页面重新连接

4. **进程状态显示异常**
   - 检查进程是否正常运行
   - 确认权限设置
   - 重启Web应用

### 日志位置

- Web应用日志：控制台输出
- main.py日志：通过Web界面查看
- 系统错误：检查终端输出

## 📞 技术支持

如遇到问题，请检查：
1. Python版本和依赖
2. 系统权限设置
3. 网络连接状态
4. 浏览器兼容性

## 🔄 更新日志

### v1.0.0
- 🎉 初始版本发布
- ✅ 进程管理功能
- ✅ 实时日志显示
- ✅ Web管理界面
- ✅ 命令行管理工具

## 📄 许可证

本项目遵循项目主体的许可证条款。 